<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linker</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/folders.css" />
</head>

<body>
  <% const displayName=currentUser && currentUser.nickname ? currentUser.nickname : currentUser && currentUser.name ?
    currentUser.name : "링커" ; %>

    <%- include('../include/_nav', { active: 'profile', displayName: displayName }) %>

      <main class="main-content" aria-label="메인 콘텐츠">
        <section class="hero-card folder-hero-card">
          <div class="hero-text folder-hero-text">
            <h1 class="hero-nickname folder-hero-nickname">
              <svg width="28" height="23" viewBox="0 0 23 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.3 18C1.6675 18 1.12623 17.7799 0.6762 17.3396C0.226167 16.8994 0.000766667 16.3695 0 15.75V2.25C0 1.63125 0.2254 1.10175 0.6762 0.6615C1.127 0.22125 1.66827 0.00075 2.3 0H9.2L11.5 2.25H20.7C21.3325 2.25 21.8741 2.4705 22.3249 2.9115C22.7757 3.3525 23.0008 3.882 23 4.5V15.75C23 16.3687 22.775 16.8986 22.3249 17.3396C21.8749 17.7806 21.3333 18.0007 20.7 18H2.3Z" fill="#ffffff"/>
              </svg>
              <span><%= folder.name %></span>
            </h1>
            <p class="folder-hero-description">
              총 <%= posts ? posts.length : 0 %>개의 저장된 글
            </p>
          </div>
        </section>

        <section class="my-board" aria-label="게시판">
          <div class="board-panels">
            <div class="board-panel is-active folder-board-panel">
              <% if (typeof posts !== 'undefined' && posts && posts.length > 0) { %>
                <% posts.forEach(post => { %>
                  <% 
                    let postUrl = '';
                    if (post.postType === 'recruit') {
                      postUrl = '/campus/' + post._id;
                    } else if (post.postType === 'seeking') {
                      postUrl = '/campus/seek/' + post._id;
                    } else if (post.postType === 'community') {
                      postUrl = '/community/' + post._id;
                    }
                  %>
                  <% if (post.postType === 'community') { %>
                    <!-- 커뮤니티 글 카드 -->
                    <article class="post-card folder-post-card community-folder-card" onclick="window.location.href='<%= postUrl %>'">
                      <div class="post-header">
                        <div class="post-header__title community-post-header-title">
                          <div class="community-post-category-wrapper">
                            <span class="community-post-category">
                              <% 
                                const categoryMap = {
                                  'free': '자유게시판',
                                  'qna': 'Q&A',
                                  'info': '정보공유'
                                };
                              %>
                              <%= categoryMap[post.category] || '자유게시판' %>
                            </span>
                          </div>
                          <h2><%= post.title %></h2>
                          <p><%= post.writer && post.writer.nickname ? post.writer.nickname : post.writer && post.writer.name ? post.writer.name : '익명' %> · <%= typeof getRelativeTime !== 'undefined' ? getRelativeTime(post.createdAt) : new Date(post.createdAt).toLocaleDateString('ko-KR') %></p>
                        </div>
                        <div class="community-post-actions" onclick="event.stopPropagation();">
                          <button type="button" class="like-btn-preview folder-like-btn" data-post-id="<%= post._id %>" data-is-liked="true">
                            <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M10 18.35L8.55 17.03C3.4 12.36 0 9.28 0 5.5 0 2.42 2.42 0 5.5 0C7.24 0 8.91 0.81 10 2.09C11.09 0.81 12.76 0 14.5 0C17.58 0 20 2.42 20 5.5C20 9.28 16.6 12.36 11.45 17.04L10 18.35Z" fill="#1D5DFF" stroke="#1D5DFF" stroke-width="1.5" stroke-linejoin="round"/>
                            </svg>
                            <span class="post-likes-<%= post._id %>"><%= post.likes || 0 %></span>
                          </button>
                          <div class="community-comment-count">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M12 4c4.418 0 8 2.91 8 6.5 0 1.3-.42 2.53-1.17 3.58l0.85 4.18-3.86-1.1C14.7 17.86 13.38 18 12 18c-4.418 0-8-2.91-8-6.5S7.582 4 12 4Z"
                                    stroke="#818181" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" fill="none"/>
                            </svg>
                            <span><%= post.comments || 0 %></span>
                          </div>
                        </div>
                      </div>
                      <div class="post-body">
                        <p class="community-post-content">
                          <%= post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content %>
                        </p>
                      </div>
                      <!-- 폴더에서 제거 버튼 -->
                      <div class="folder-remove-section">
                        <button type="button" class="remove-from-folder-btn" data-post-id="<%= post._id %>" data-post-type="<%= post.postType %>"
                          onclick="event.stopPropagation(); removeFromFolder('<%= post._id %>', '<%= post.postType %>')">
                          폴더에서 제거
                        </button>
                      </div>
                    </article>
                  <% } else { %>
                    <!-- 캠퍼스/공모전 글 카드 -->
                    <article class="post-card folder-post-card" onclick="window.location.href='<%= postUrl %>'">
                      <!-- 상단: 제목 + 스크랩/댓글 -->
                      <div class="folder-post-header">
                        <h2 class="folder-post-title"><%= post.title %></h2>
                        <div class="folder-post-actions" onclick="event.stopPropagation();">
                          <button type="button" class="scrap-btn-preview folder-scrap-btn" data-post-id="<%= post._id %>" data-post-type="<%= post.postType %>" data-is-scrapped="true">
                            <svg width="14" height="17" viewBox="0 0 16 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M13.7139 1C14.0837 1 14.3718 1.1174 14.6318 1.37012C14.891 1.62205 15.0004 1.88812 15 2.2207V18.5L8.38477 15.7432C8.13863 15.6406 7.86137 15.6406 7.61523 15.7432L1 18.5V2.22266C1 1.88855 1.10965 1.6221 1.36816 1.37109C1.59622 1.14975 1.84572 1.03206 2.15234 1.00586L2.28711 1H13.7139Z" stroke="#1D5DFF" stroke-width="2" stroke-linejoin="round" fill="#1D5DFF"/>
                            </svg>
                            <span class="post-scraps-preview-<%= post._id %>"><%= post.scraps || 0 %></span>
                          </button>
                          <div class="folder-comment-count">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M12 4c4.418 0 8 2.91 8 6.5 0 1.3-.42 2.53-1.17 3.58l0.85 4.18-3.86-1.1C14.7 17.86 13.38 18 12 18c-4.418 0-8-2.91-8-6.5S7.582 4 12 4Z"
        stroke="#818181" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" fill="none"/>
</svg>
                            <span><%= post.comments || 0 %></span>
                          </div>
                        </div>
                      </div>
                      <!-- 본문: 내용 -->
                      <div class="folder-post-body">
                        <p class="folder-post-content">
                          <%= post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content %>
                        </p>
                      </div>
                      <!-- 해시태그 -->
                      <% if (post.hashtags && post.hashtags.length > 0) { %>
                        <div class="folder-post-hashtags">
                          <% post.hashtags.forEach(tag => { %>
                            <span class="folder-post-hashtag">#<%= tag %></span>
                          <% }) %>
                        </div>
                      <% } else { %>
                        <div class="folder-post-hashtags-empty"></div>
                      <% } %>
                      <!-- 하단: 글쓴이 + 마감일 -->
                      <div class="folder-post-footer">
                        <span><%= post.writer && post.writer.nickname ? post.writer.nickname : post.writer && post.writer.name ? post.writer.name : '익명' %></span>
                        <span>마감일: <%= post.postType === 'recruit' && post.deadline ? new Date(post.deadline).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\./g, '.').replace(/\s/g, '') : '-' %></span>
                      </div>
                    <!-- 폴더에서 제거 버튼 -->
                    <div class="folder-remove-section">
                      <button type="button" class="remove-from-folder-btn" data-post-id="<%= post._id %>" data-post-type="<%= post.postType %>"
                        onclick="event.stopPropagation(); removeFromFolder('<%= post._id %>', '<%= post.postType %>')">
                        폴더에서 제거
                      </button>
                    </div>
                  </article>
                  <% } %>
                <% }) %>
              <% } else { %>
                <article class="post-card post-card--empty folder-post-card--empty" aria-live="polite">
                  <div class="post-empty__message">
                    <strong>이 폴더에 저장된 글이 없습니다</strong>
                    글을 이 폴더에 추가해보세요.
                  </div>
                </article>
              <% } %>
            </div>
          </div>
        </section>
      </main>

      <script>
        const folderId = '<%= folder._id %>';

        // 폴더에서 글 제거
        function removeFromFolder(postId, postType) {
          if (!confirm('이 글을 폴더에서 제거하시겠습니까?')) {
            return;
          }

          fetch(`/folders/${folderId}/posts/${postId}?postType=${postType}`, {
            method: 'DELETE',
            credentials: 'same-origin'
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              window.location.reload();
            } else {
              alert(data.message || '폴더에서 제거하는데 실패했습니다.');
            }
          })
          .catch(error => {
            console.error('폴더에서 제거 중 오류:', error);
            alert('폴더에서 제거 중 오류가 발생했습니다.');
          });
        }
      </script>
</body>

</html>


